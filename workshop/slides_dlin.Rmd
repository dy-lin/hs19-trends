---
title: 'Hackseq: Trends in Bioinformatics'
author: "Diana Lin and Emma Garlock"
date: "14/11/2019"
output:
  ioslides_presentation
---


```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width=12, fig.height=8)
# tidy.opts=list(width.cutoff=60),tidy=TRUE
# knitr::opts_chunk$set(echo = TRUE, error = FALSE, message = FALSE, warning = FALSE, fig.width=12, fig.height=8)
```

```{r setup, include=FALSE}
library(ggplot2)
# library(plotly)
# library(cowplot)
library(tidyverse)
library(gganimate)
# library(fulltext)
library(knitr)
```

```{r load sequencing data, include=FALSE, echo = FALSE}
# Load data for all 7 sequencing types
url <- "https://raw.githubusercontent.com/dy-lin/hs19-trends/master/data/sequencing-specific.csv"
seq_spec <- read_csv(url)
```
## Trends in Bioinformatics
* __Bioinformatics:__ the development and use of computational methods in genetics and genomics
1. Divide the field of Bioinformatics into topics
    + Sequencing, Assembly, ...
2. Determine search terms for each subjects
    + Sequencing: Sanger, next-generation sequencing, ...
3. Analyze trends by webscraping/textmining
    + using `fulltext`, `pubchunks`

##  Analogy
Field | Topic | Search Terms 
------|-------|----------------
Bioinformatics | Sequencing | Sanger, next-generation sequencing, ...
Bioinformatics | Assembly | Short read assembly, long read assembly, ...
Fruits | Apples | Ambrosia, Gala, McIntosh, Granny Smith, ...
Fruits | Oranges | Navel, Mandarin, Tangerine, Clementine, ...

## Webscraping Results

```{r overview code, echo = FALSE, message = FALSE}
resFound <- read_csv("https://raw.githubusercontent.com/dy-lin/hs19-trends/master/workshop/data/webscrape_overall.csv")

overview <- resFound %>%
  group_by(topic, db) %>%
  summarize(sum = sum(found)) %>%
  ggplot(aes(x = topic, y = sum)) +
  geom_col(aes(fill = db)) + 
  theme(axis.text.x = element_text(angle = 30),
        text = element_text(size = 20),
        axis.title = element_text(size =18),
        axis.text = element_text(size=12)
        ) +
  scale_y_continuous(label = scales::comma_format()) +
  labs(title = "", y = "# Papers Found", x = "Topic", fill = "Database") + 
  ggtitle("Overview of Topics Across Databases")
```
Dataframe:
```{r print overview table, echo = FALSE}
head(resFound, 12L)
```

## Webscraping Results

Stacked Bar Graph:
```{r print overview graph, echo = FALSE, out.width = "830px"}
print(overview)
```

<!-- ```{r, out.width = "830px", echo = FALSE}
knitr::include_graphics("https://dy-lin.github.io/hs19-trends/figures/overview.png")
```-->

## Our Dataset {.smaller}
Let's look at the search terms of one specific topic, one specific jounral:

__Sequencing in the Public Library of Science (PLoS)__
```{r, echo = FALSE}
head(seq_spec, 18L)
```

## Regular Bar Graph {.smaller}

Load the dataset
```{r load data, message = FALSE}
base <- "https://raw.githubusercontent.com/dy-lin/hs19-trends/master/workshop/"
seq_spec <- "data/sequencing-specific-processed.csv"
url <- paste0(base, seq_spec)
seq_data <- read_csv(url)
```

A glimpse into the dataset (top 5):
```{r glimpse, echo = FALSE}
seq_data %>% drop_na() %>% arrange(desc(total)) %>% head(5L)  %>% kable()
```

## Regular Bar Graph
```{r regular bar, out.width="600px"}
reg <- seq_data %>%
  drop_na() %>%
  ggplot(aes(x = topic, y = cum_total, fill = topic)) +
  geom_col() + 
  facet_wrap(~ Year, ncol = 8) + 
  coord_flip() +
  scale_fill_viridis_d() +
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        legend.position = "bottom") +
  geom_text(aes(y = cum_total, 
                label = topic), 
            hjust = "left", 
            fontface = "bold", 
            nudge_y = 50)
```
## Regular Bar Graph
```{r, out.width="800px", echo = FALSE}
print(reg)
```



## Animated _Racing_ Bar Graph
In order to make a racing bar chart, where the bars overtake one another, we need to rank the topics for each year:

```{r ordering racing bars}
ordered_df <- NULL

for (yr in 2003:2019) {
  order <- seq_data %>% 
    filter(Year == yr) %>% 
    arrange(cum_total) %>% 
    mutate(ordering = row_number())
  
  ordered_df <- ordered_df %>% rbind(order)
}
```

## Animated _Racing_ Bar Graph {.smaller}
Here's what the dataset looks like now:
```{r, echo = FALSE}
ordered_df %>% head(9L) %>% kable()
```


```{r racing bars animate, echo=FALSE, eval = FALSE}
p <- ordered_df %>% 
  ggplot(aes(ordering, group = topic))+
  geom_col(aes(y = cum_total,
                width = 0.9,
                fill = topic)) +
  geom_text(aes(y = cum_total, label = topic), hjust = "left", fontface = "bold", nudge_y = 50) +
  scale_fill_viridis_d() +
  coord_cartesian(clip = "off", expand = FALSE) +
  coord_flip() +
#animate
  transition_states(Year, transition_length = 8, state_length = 4, wrap = FALSE) +
  ease_aes("cubic-in-out") +
#aesthetics
  labs(subtitle = "Trends in sequencing methods",title = "Year {closest_state}", y = "cumulative total papers") +
  theme(plot.background = element_blank(),
        legend.position = "none",
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        text = element_text(size=14),
        plot.title = element_text(size = 35)) +
  ylim(0,1300) +
  xlab("") 

#rendering the animation
animate(p, nframes = 100,
        fps = 5,
        end_pause = 10)
#animate(p, nframes = 750, 
 #       fps = 20, 
  #      end_pause = 10)
```

